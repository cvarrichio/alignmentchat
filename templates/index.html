<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/chota.min.css">
    <link rel="stylesheet" href="/static/css/alignment.css">
    <title>AlignmentGPT</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">

        let websocket;

        async function sendWebSocketMessage(data) {
            if (websocket.readyState === WebSocket.OPEN) {
                websocket.send(JSON.stringify(data));
            }
        }

        async function updateMemory(question, answer) {
            sendWebSocketMessage({
                type: 'update_memory',
                question: question,
                answer: answer
            });
        }

        async function getQuestions(question) {
            sendWebSocketMessage({
                type: 'get_questions',
                message: question
            });
        }

        $(document).ready(function () {
            websocket = new WebSocket('ws://' + window.location.host + '/ws');

            websocket.onmessage = function (event) {
                const data = JSON.parse(event.data);

                if (data.type === 'message') {
                    const formattedMessage = data.message.replace(/\n/g, '<br>');
                    $('#message-list li.typing-effect').append(formattedMessage);
                } else if (data.type === 'memory_updated') {
                    console.log('Memory updated');
                } else if (data.type === 'questions_received') {
                    alert('Getting questions');
                }
            };

            $('#message-form').submit(function (event) {
                event.preventDefault();

                const input_message = $('#message-form input[name=message]').val()
                getQuestions(input_message);
                $('#message-list').append('<li><strong>' + input_message + '</strong></li>');

                sendWebSocketMessage({
                    type: 'submit_message',
                    message: input_message
                });

                // Reset the message input field
                $('#message-form')[0].reset();

                const newMessage = document.createElement('li');
                newMessage.className = 'typing-effect';
                $('#message-list').append(newMessage);

                window.scrollTo(0, document.body.scrollHeight);
                
            });
        });

    </script>
</head>

<body>
    <h1>AlignmentGPT</h1>
    <ul id="message-list">
        <li>Welcome to AlignmentGPT. Please ask a question about AI or AI safety.</li>
        <!-- Existing messages will be inserted here -->
    </ul>
    <form id="message-form" method="POST">
        <input type="text" name="message" placeholder="Enter your message">
        <button type="submit">Submit</button>
    </form>
</body>

</html>